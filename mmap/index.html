<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Marauder's Map</title>
	<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=true&amp;libraries=places"></script>
	</script>
	<link rel="stylesheet" href="style.css">
	<script>
		var characters = [ ];
		var students = [ ];

		function initializeMap(init_lat, init_lng) {
			var init_lat = 42.4060269;
    		var init_lng = -71.118939;

	    	// set the map options (zoom and location)
			mapOptions = {
				center: {lat: init_lat, lng: init_lng},
				zoom: 12
			};

			// create the map
			map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
		}

		function addMarker(in_lat,in_lng) {
	        marker = new google.maps.Marker({
			    position: {lat: in_lat, lng: in_lng},
			    map: map
			});
	    }

		function getData() {
			if (xhr.readyState == 4 && xhr.status == 200) {
	    		var data = JSON.parse(xhr.responseText);

	    		characters = data["characters"];
	    		students = data["students"];

	    		console.log(characters);

	    		for (i=0;i<characters.length;i++){
	    			character_lat = characters[i]['loc']['latitude'];
	    			character_lng = characters[i]['loc']['longitude'];

	    			addMarker(character_lat,character_lng);
	    		}

	    	} else if (xhr.readyState == 4) {
	    		console.log('There was an error retrieving the data.');
	    	}
		}
		
		xhr = new XMLHttpRequest();
		xhr.open('post', 'http://chickenofthesea.herokuapp.com/sendLocation', true);
		xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhr.onreadystatechange = getData;

		if (navigator.geolocation) {
	   		navigator.geolocation.getCurrentPosition(function(position) {
			  var curr_lat = position.coords.latitude;
			  var curr_lng = position.coords.longitude;

			  xhr.send("login=TimmyBurch&lat=" + curr_lat + "&lng=" + curr_lng);
			  map.setCenter({lat: curr_lat, lng: curr_lng});
			  addMarker(curr_lat,curr_lng);
			});
	   	} else {
	   		// no geolocation
	   	}
		 

		google.maps.event.addDomListener(window, 'load', initializeMap);
	</script>
</head>
<body>
	<div id="map-canvas"></div>
</body>
</html>