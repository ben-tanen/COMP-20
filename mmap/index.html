<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Marauder's Map</title>
	<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=true&amp;libraries=places"></script>
	</script>
	<link rel="stylesheet" href="style.css">
	<script>
		function initialize() {
			// standard tufts coordinates
			var init_lat = 42.4060269;
	    	var init_lng = -71.118939;

	    	// set the map options (zoom and location)
			var mapOptions = {
				center: {lat: init_lat, lng: init_lng},
				zoom: 12
			};

			// create the map
			var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

			xhr = new XMLHttpRequest();

		    // open connection with MBTA Redline (JSON file)
		    xhr.open('post', 'http://chickenofthesea.herokuapp.com/sendLocation', true);

		    xhr.setRequestHeader(
			   "login", "TimmyBurch"
			);

			if (navigator.geolocation){
				navigator.geolocation.getCurrentPosition(function(position) {
					xhr.setRequestHeader("lat", position.coords.latitude);
					xhr.setRequestHeader("lng", position.coords.longitude);
					pinLocation(position.coords.latitude,position.coords.longitude);
				});
			} else {
				console.log("Error in Navigator")
			}

			function pinLocation(input_lat,input_lng) {
				var marker = new google.maps.Marker({
				    position: {lat: input_lat, lng: input_lng},
				    map: map
				});
			}

		    // if change in readystate, update pins
		    xhr.onreadystatechange = function() {
		    	if (xhr.readyState == 4 && xhr.status == 200) {
		    		var data = JSON.parse(xhr.responseText);
		    		
		    		console.log(data);

		    		// characters = data["characters"];
		    		// students = data["students"];

		    		// for each student & character, add pin

		    	} else if (xhr.readyState == 4) {
		    		console.log('There was an error retrieving the data.');
		    	}
		    };

		    console.log(xhr.getAllResponseHeaders());

		    xhr.send();

		}

		// call google map on page load
		google.maps.event.addDomListener(window, 'load', initialize);
	</script>
</head>
<body>
	<div id="map-canvas"></div>
</body>
</html>